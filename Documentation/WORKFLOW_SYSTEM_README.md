# Project Workflow System - Complete Guide

## üéØ P≈ôehled syst√©mu

Project Workflow System je pokroƒçil√° platforma pro vytv√°≈ôen√≠, spr√°vu a spou≈°tƒõn√≠ AI-powered workflow s vizu√°ln√≠m designerem, real-time monitoringem a integrac√≠ s orchestr√°tory.

## üèóÔ∏è Architektura

### Z√°kladn√≠ komponenty
```
PROJECT
  ‚îî‚îÄ‚îÄ STAGE (workflow krok)
       ‚îú‚îÄ‚îÄ Orchestrator (ConversationOrchestrator / ToolChainOrchestrator)
       ‚îú‚îÄ‚îÄ ReAct Agent (voliteln√Ω AI reasoning)
       ‚îî‚îÄ‚îÄ Tools[] (konkr√©tn√≠ akce/n√°stroje)
```

### Technologie
- **Backend**: ASP.NET Core, Entity Framework, SignalR
- **Frontend**: Razor Views, AdminLTE, JavaScript/jQuery
- **Database**: PostgreSQL (production) / In-Memory (development)
- **AI Integration**: Ollama models, LlmTornado toolkit

## üöÄ Hlavn√≠ funkce

### 1. Vizu√°ln√≠ Workflow Designer
- **URL**: `https://localhost:5005/WorkflowDesigner?projectId={id}`
- Drag & drop interface pro vytv√°≈ôen√≠ workflow
- Real-time validace a n√°hled
- Konfigurace orchestr√°tor≈Ø a tools
- Canvas s vizu√°ln√≠mi spojen√≠mi mezi stages

### 2. Workflow Templates
- **URL**: `https://localhost:5005/ProjectWorkflows/Templates`
- Galerie workflow ≈°ablon
- Import/export ≈°ablon (JSON)
- Vytvo≈ôen√≠ projektu ze ≈°ablony
- Spr√°va a verzov√°n√≠ ≈°ablon

### 3. Workflow Execution
- **API**: `POST /api/workflow/{projectId}/execute`
- Spou≈°tƒõn√≠ workflow p≈ôes orchestr√°tory
- Real-time monitoring s SignalR
- Podpora pro AI modely a tools
- Error handling a retry mechanismy

### 4. Real-time Monitoring
- **URL**: `https://localhost:5005/ProjectWorkflows/Monitor`
- Live sledov√°n√≠ bƒõ≈æ√≠c√≠ch workflow
- SignalR notifikace o progress
- Detailed logs a stage results
- Mo≈ænost zru≈°en√≠ bƒõhu

## üìã Rychl√Ω start

### 1. Vytvo≈ôen√≠ nov√©ho workflow
```bash
# 1. Vytvo≈ôte nov√Ω projekt
curl -X POST https://localhost:5005/api/projects \
  -H "Content-Type: application/json" \
  -d '{
    "name": "My Workflow",
    "description": "Test workflow",
    "type": "Development"
  }'

# 2. Otev≈ôete workflow designer
# https://localhost:5005/WorkflowDesigner?projectId={project-id}

# 3. P≈ôidejte stages a tools pomoc√≠ UI
```

### 2. Spu≈°tƒõn√≠ workflow
```bash
# Spu≈°tƒõn√≠ workflow
curl -X POST https://localhost:5005/api/workflow/{project-id}/execute \
  -H "Content-Type: application/json" \
  -d '{
    "parameters": {
      "input": "test data"
    },
    "initiatedBy": "user"
  }'

# Monitoring bƒõhu
curl https://localhost:5005/api/workflow/executions/{execution-id}/status
```

### 3. Pou≈æit√≠ ≈°ablon
```bash
# Seznam ≈°ablon
curl https://localhost:5005/api/workflow/templates

# Vytvo≈ôen√≠ projektu ze ≈°ablony
curl -X POST https://localhost:5005/api/workflow/templates/{template-id}/create-project \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Project from Template",
    "description": "New project"
  }'
```

## üîß API Reference

### Workflow Management
- `GET /api/workflow/{projectId}/design` - Z√≠skat workflow design
- `POST /api/workflow/design` - Ulo≈æit workflow design  
- `GET /api/workflow/{projectId}/validate` - Validovat workflow
- `GET /api/workflow/components` - Dostupn√© komponenty

### Stage Management
- `GET /api/workflow/{projectId}/stages` - Seznam stages
- `POST /api/workflow/stages` - Vytvo≈ôit stage
- `PUT /api/workflow/stages/{stageId}` - Upravit stage
- `DELETE /api/workflow/stages/{stageId}` - Smazat stage
- `POST /api/workflow/stages/{stageId}/duplicate` - Duplikovat stage

### Workflow Execution
- `POST /api/workflow/{projectId}/execute` - Spustit workflow
- `GET /api/workflow/executions/{executionId}/status` - Status execution
- `POST /api/workflow/executions/{executionId}/cancel` - Zru≈°it execution
- `GET /api/workflow/executions/{executionId}/stages` - V√Ωsledky stages

### Template Management
- `GET /api/workflow/templates` - Seznam ≈°ablon
- `POST /api/workflow/{projectId}/convert-to-template` - P≈ôev√©st na ≈°ablonu
- `POST /api/workflow/templates/{templateId}/create-project` - Vytvo≈ôit ze ≈°ablony

## üé® UI Komponenty

### Workflow Designer
```javascript
// Inicializace workflow designer
const designer = new WorkflowDesigner({
    projectId: 'project-guid',
    container: '#workflow-canvas',
    apiBaseUrl: '/api/workflow'
});

// Event handling
designer.on('stageAdded', function(stage) {
    console.log('New stage added:', stage);
});

designer.on('validationError', function(errors) {
    console.log('Validation errors:', errors);
});
```

### SignalR Monitoring
```javascript
// P≈ôipojen√≠ k workflow monitoring
const connection = new signalR.HubConnectionBuilder()
    .withUrl("/workflowHub")
    .build();

// Event handlers
connection.on("WorkflowStarted", function(data) {
    updateProgress(data);
});

connection.on("StageCompleted", function(data) {
    markStageComplete(data);
});

// Start monitoring
connection.start().then(function() {
    connection.invoke("JoinExecution", executionId);
});
```

## üîå Orchestr√°tory

### ConversationOrchestrator
- Integrace s Ollama AI modely
- Automatick√° detekce pot≈ôeby tools
- Support pro streaming responses
- ReAct pattern pro reasoning

### ToolChainOrchestrator  
- Sekvenƒçn√≠/paraleln√≠ execution tools
- Parameter mapping mezi tools
- Error handling strategies
- Conditional execution

### ProjectStageOrchestrator
- High-level orchestrace stages
- Delegace na sub-orchestr√°tory
- Context management
- Progress tracking

## üõ†Ô∏è Tools Integration

### Registrace tools
```csharp
public class MyCustomTool : ITool
{
    public string Id => "my_custom_tool";
    public string Name => "My Custom Tool";
    public string Category => "Custom";
    
    public IReadOnlyList<IToolParameter> Parameters => new[]
    {
        new SimpleToolParameter
        {
            Name = "input",
            Type = ToolParameterType.String,
            IsRequired = true
        }
    };
    
    public async Task<IToolResult> ExecuteAsync(
        Dictionary<string, object> parameters,
        CancellationToken cancellationToken)
    {
        // Tool implementation
        return new ToolResult 
        { 
            IsSuccess = true, 
            Data = result 
        };
    }
}
```

### Pou≈æit√≠ v stages
```json
{
  "stageTools": [
    {
      "toolId": "my_custom_tool",
      "order": 1,
      "configuration": {
        "timeout": 30,
        "retries": 3
      },
      "inputMapping": {
        "input": "previousStage.output"
      }
    }
  ]
}
```

## üìä Monitoring a Logs

### Execution Tracking
- Real-time status updates
- Stage-by-stage progress
- Tool execution results
- Error details a stack traces
- Performance metrics

### SignalR Events
- `WorkflowStarted` - Workflow zaƒçal
- `StageStarted` - Stage zah√°jen
- `StageCompleted` - Stage dokonƒçen
- `ToolExecuted` - Tool vykon√°n
- `WorkflowCompleted` - Workflow dokonƒçen

## üß™ Testing

### Unit Tests
```bash
# Spu≈°tƒõn√≠ unit test≈Ø
dotnet test OptimalyAI.Tests

# Specifick√© testy
dotnet test --filter "WorkflowExecutionService"
```

### Integration Tests
```bash
# E2E test cel√©ho syst√©mu
./Test/test-workflow-e2e.sh

# Test workflow execution
./Test/test-workflow-execution.sh
```

### Manual Testing
1. Otev≈ôete workflow designer
2. Vytvo≈ôte test workflow s stages
3. P≈ôidejte tools do stages
4. Spus≈•te workflow
5. Sledujte monitoring

## üîí Security

### API Security
- Rate limiting (100 req/min)
- CORS konfigurace
- Validation na v≈°ech endpoints
- Error handling bez stack traces

### Tool Security
```csharp
// Tool security validation
public class ToolSecurityService : IToolSecurity
{
    public async Task<bool> ValidateToolExecution(
        string toolId, 
        Dictionary<string, object> parameters)
    {
        // Security validation logic
        return true;
    }
}
```

## üöÄ Deployment

### Development
```bash
# Start aplikace
python run-dev.py

# Nebo p≈ô√≠mo
dotnet watch run --project OptimalyAI.csproj
```

### Production
```bash
# PostgreSQL database
./docker-db-start.sh

# Apply migrations
dotnet ef database update

# Build a spu≈°tƒõn√≠
dotnet build --configuration Release
dotnet run --configuration Release
```

### Environment Configuration
```json
{
  "UseProductionDatabase": true,
  "ConnectionStrings": {
    "DefaultConnection": "Host=localhost;Database=optimalyai_db;Username=optimaly;Password=OptimalyAI2024!"
  }
}
```

## üìà Performance

### Optimalizace
- Async/await patterns v≈°ude
- Entity Framework optimalizace
- SignalR connection pooling
- Client-side caching

### Monitoring
- Application Insights integration
- Custom metrics collection
- Performance counters
- Real-time dashboard

## üêõ Troubleshooting

### ƒåast√© probl√©my

1. **Workflow se nespust√≠**
   ```bash
   # Zkontrolujte validaci
   curl https://localhost:5005/api/workflow/{projectId}/validate
   ```

2. **SignalR nefunguje**
   ```javascript
   // Zkontrolujte connection status
   console.log(connection.state);
   ```

3. **Tools sel≈æe**
   ```bash
   # Zkontrolujte tool registry
   curl https://localhost:5005/api/tools
   ```

### Debug m√≥dy
```bash
# Enable detailed logging
export ASPNETCORE_ENVIRONMENT=Development
dotnet run
```

## üìö Dal≈°√≠ zdroje

- **API dokumentace**: `https://localhost:5005/api/docs`
- **Implementaƒçn√≠ pl√°n**: `Documentation/Implementation/PROJECT_WORKFLOW_REDESIGN_PLAN.md`
- **CLAUDE.md**: Pokyny pro Claude Code assistant
- **Test scripts**: `Test/` slo≈æka

## üéâ Z√°vƒõr

Project Workflow System poskytuje kompletn√≠ platformu pro vytv√°≈ôen√≠ a spou≈°tƒõn√≠ AI-powered workflow s pokroƒçil√Ωmi funkcemi:

- ‚úÖ Vizu√°ln√≠ workflow designer
- ‚úÖ Real-time execution monitoring  
- ‚úÖ AI orchestr√°tory integrace
- ‚úÖ Template management
- ‚úÖ SignalR real-time updates
- ‚úÖ Comprehensive API
- ‚úÖ Testing tools

Syst√©m je p≈ôipraven k produkƒçn√≠mu nasazen√≠ a dal≈°√≠mu rozvoji!