@model OAI.Core.DTOs.Programming.UpdateWebApplicationDto
@{
    ViewData["Title"] = "Upravit aplikaci - " + Model.Name;
}

@section Styles {
    <style>
        .form-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section-header {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            margin: 0;
        }
        
        .form-section {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .form-section:last-child {
            border-bottom: none;
        }
        
        .required {
            color: #dc3545;
        }
        
        .form-help {
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .form-control:focus {
            border-color: #f39c12;
            box-shadow: 0 0 0 0.2rem rgba(243, 156, 18, 0.25);
        }
        
        .btn-primary {
            background-color: #f39c12;
            border-color: #f39c12;
        }
        
        .btn-primary:hover {
            background-color: #e67e22;
            border-color: #e67e22;
        }
    </style>
}

<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">@ViewData["Title"]</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item"><a href="#">Programování</a></li>
                    <li class="breadcrumb-item"><a href="@Url.Action("Applications")">Aplikace</a></li>
                    <li class="breadcrumb-item"><a href="@Url.Action("ApplicationDetail", new { id = Model.Id })">@Model.Name</a></li>
                    <li class="breadcrumb-item active">Upravit</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <form asp-action="EditApplication" asp-route-id="@Model.Id" method="post" id="editApplicationForm">
                    <input asp-for="Id" type="hidden" />
                    
                    <div class="form-card">
                        <div class="section-header">
                            <h4 class="mb-0">
                                <i class="fas fa-edit mr-2"></i>
                                Úprava aplikace
                            </h4>
                        </div>

                        <!-- Základní informace -->
                        <div class="form-section">
                            <h5 class="mb-3">
                                <i class="fas fa-info-circle mr-2"></i>Základní informace
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="Name">Název <span class="required">*</span></label>
                                        <input asp-for="Name" class="form-control" placeholder="Název aplikace">
                                        <span asp-validation-for="Name" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="Version">Verze</label>
                                        <input asp-for="Version" class="form-control" placeholder="1.0.0">
                                        <span asp-validation-for="Version" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label asp-for="Description">Popis</label>
                                <textarea asp-for="Description" class="form-control" rows="3" 
                                         placeholder="Stručný popis aplikace a jejího účelu"></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="Status">Status</label>
                                        <select asp-for="Status" class="form-control">
                                            <option value="Development">Development</option>
                                            <option value="Testing">Testing</option>
                                            <option value="Production">Production</option>
                                            <option value="Maintenance">Maintenance</option>
                                        </select>
                                        <span asp-validation-for="Status" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="Priority">Priorita</label>
                                        <select asp-for="Priority" class="form-control">
                                            <option value="Low">Low</option>
                                            <option value="Medium">Medium</option>
                                            <option value="High">High</option>
                                            <option value="Critical">Critical</option>
                                        </select>
                                        <span asp-validation-for="Priority" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Technické specifikace -->
                        <div class="form-section">
                            <h5 class="mb-3">
                                <i class="fas fa-cogs mr-2"></i>Technické specifikace
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="ProgrammingLanguage">Programovací jazyk <span class="required">*</span></label>
                                        <select asp-for="ProgrammingLanguage" class="form-control">
                                            <option value="">Vyberte jazyk</option>
                                            <option value="C#">C#</option>
                                            <option value="JavaScript">JavaScript</option>
                                            <option value="TypeScript">TypeScript</option>
                                            <option value="Python">Python</option>
                                            <option value="Java">Java</option>
                                            <option value="PHP">PHP</option>
                                            <option value="Go">Go</option>
                                            <option value="Rust">Rust</option>
                                            <option value="Other">Jiný</option>
                                        </select>
                                        <span asp-validation-for="ProgrammingLanguage" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="Framework">Framework <span class="required">*</span></label>
                                        <select asp-for="Framework" class="form-control">
                                            <option value="">Vyberte framework</option>
                                            <option value="ASP.NET Core">ASP.NET Core</option>
                                            <option value="React">React</option>
                                            <option value="Angular">Angular</option>
                                            <option value="Vue.js">Vue.js</option>
                                            <option value="Node.js">Node.js</option>
                                            <option value="Django">Django</option>
                                            <option value="Flask">Flask</option>
                                            <option value="Spring Boot">Spring Boot</option>
                                            <option value="Laravel">Laravel</option>
                                            <option value="Other">Jiný</option>
                                        </select>
                                        <span asp-validation-for="Framework" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="Architecture">Architektura</label>
                                        <select asp-for="Architecture" class="form-control">
                                            <option value="">Vyberte architekturu</option>
                                            <option value="MVC">MVC</option>
                                            <option value="Clean Architecture">Clean Architecture</option>
                                            <option value="Microservices">Microservices</option>
                                            <option value="Monolith">Monolith</option>
                                            <option value="Serverless">Serverless</option>
                                            <option value="Layered">Layered</option>
                                            <option value="Hexagonal">Hexagonal</option>
                                            <option value="Other">Jiná</option>
                                        </select>
                                        <span asp-validation-for="Architecture" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="Database">Databáze</label>
                                        <select asp-for="Database" class="form-control">
                                            <option value="">Vyberte databázi</option>
                                            <option value="PostgreSQL">PostgreSQL</option>
                                            <option value="MySQL">MySQL</option>
                                            <option value="SQL Server">SQL Server</option>
                                            <option value="MongoDB">MongoDB</option>
                                            <option value="Redis">Redis</option>
                                            <option value="SQLite">SQLite</option>
                                            <option value="Oracle">Oracle</option>
                                            <option value="Other">Jiná</option>
                                        </select>
                                        <span asp-validation-for="Database" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cesty a odkazy -->
                        <div class="form-section">
                            <h5 class="mb-3">
                                <i class="fas fa-link mr-2"></i>Cesty a odkazy
                            </h5>
                            
                            <div class="form-group">
                                <label asp-for="ProjectPath">Cesta k projektu <span class="required">*</span></label>
                                <input asp-for="ProjectPath" class="form-control" 
                                       placeholder="/Users/username/Projects/MyApp nebo C:\Projects\MyApp">
                                <small class="form-help">Absolutní cesta k root složce projektu na disku</small>
                                <span asp-validation-for="ProjectPath" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Url">URL aplikace</label>
                                <input asp-for="Url" class="form-control" 
                                       placeholder="https://myapp.com nebo http://localhost:3000">
                                <small class="form-help">URL kde běží aplikace (dev/staging/prod)</small>
                                <span asp-validation-for="Url" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="GitRepository">Git repository</label>
                                <input asp-for="GitRepository" class="form-control" 
                                       placeholder="https://github.com/username/repository">
                                <small class="form-help">URL Git repository</small>
                                <span asp-validation-for="GitRepository" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Dodatečné informace -->
                        <div class="form-section">
                            <h5 class="mb-3">
                                <i class="fas fa-tags mr-2"></i>Dodatečné informace
                            </h5>
                            
                            <div class="form-group">
                                <label asp-for="Tags">Tagy</label>
                                <input asp-for="Tags" class="form-control" 
                                       placeholder="web, api, admin, frontend, backend">
                                <small class="form-help">Tagy oddělené čárkami pro kategorizaci</small>
                                <span asp-validation-for="Tags" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="Notes">Poznámky</label>
                                <textarea asp-for="Notes" class="form-control" rows="4" 
                                         placeholder="Podrobné poznámky, dokumentace, odkazy na další zdroje..."></textarea>
                                <span asp-validation-for="Notes" class="text-danger"></span>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label asp-for="LastDeployment">Datum posledního deploymentu</label>
                                        <input asp-for="LastDeployment" type="date" class="form-control">
                                        <span asp-validation-for="LastDeployment" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="custom-control custom-switch mt-4 pt-2">
                                            <input asp-for="IsActive" type="checkbox" class="custom-control-input" id="isActiveSwitch">
                                            <label class="custom-control-label" for="isActiveSwitch">Aktivní aplikace</label>
                                        </div>
                                        <small class="form-help">Označte pokud je aplikace aktivně vyvíjena nebo provozována</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tlačítka -->
                        <div class="card-footer">
                            <div class="d-flex justify-content-between">
                                <a href="@Url.Action("ApplicationDetail", new { id = Model.Id })" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left mr-1"></i>Zpět na detail
                                </a>
                                <div>
                                    <a href="@Url.Action("Applications")" class="btn btn-outline-secondary mr-2">
                                        <i class="fas fa-list mr-1"></i>Seznam aplikací
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save mr-1"></i>Uložit změny
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Initialize form validation
            $('#editApplicationForm').on('submit', function(e) {
                // Basic client-side validation
                let isValid = true;
                
                // Check required fields
                $('input[required], select[required]').each(function() {
                    if (!$(this).val()) {
                        $(this).addClass('is-invalid');
                        isValid = false;
                    } else {
                        $(this).removeClass('is-invalid');
                    }
                });
                
                if (!isValid) {
                    e.preventDefault();
                    toastr.error('Prosím vyplňte všechna povinná pole');
                }
            });
            
            // Remove validation errors on input
            $('input, select, textarea').on('input change', function() {
                $(this).removeClass('is-invalid');
            });
            
            // Auto-format tags
            $('#Tags').on('blur', function() {
                let tags = $(this).val();
                if (tags) {
                    // Clean up tags - remove extra spaces, normalize commas
                    tags = tags.split(',')
                              .map(tag => tag.trim())
                              .filter(tag => tag.length > 0)
                              .join(', ');
                    $(this).val(tags);
                }
            });
            
            // Path validation
            $('#ProjectPath').on('blur', function() {
                let path = $(this).val();
                if (path && !path.match(/^([a-zA-Z]:|\/)/)) {
                    toastr.warning('Cesta by měla být absolutní (začínat / nebo C:\\)');
                }
            });
            
            // URL validation
            $('#Url, #GitRepository').on('blur', function() {
                let url = $(this).val();
                if (url && !url.match(/^https?:\/\//)) {
                    $(this).val('https://' + url);
                }
            });
            
            // Show unsaved changes warning
            let formChanged = false;
            $('#editApplicationForm input, #editApplicationForm select, #editApplicationForm textarea').on('input change', function() {
                formChanged = true;
            });
            
            $(window).on('beforeunload', function(e) {
                if (formChanged) {
                    return 'Máte neuložené změny. Opravdu chcete opustit stránku?';
                }
            });
            
            // Don't show warning when form is submitted
            $('#editApplicationForm').on('submit', function() {
                formChanged = false;
            });
        });
    </script>
}

